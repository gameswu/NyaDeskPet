# å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£åŒ…å« NyaDeskPet çš„åº•å±‚æ¶æ„ã€æ ¸å¿ƒæ¨¡å—å®ç°ã€å®‰å…¨ç³»ç»Ÿè®¾è®¡ä»¥åŠå¼€å‘è€…ç›¸å…³çš„æŠ€æœ¯ç»†èŠ‚ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæ¶æ„å›¾

```mermaid
graph TB
    subgraph Desktop["æ¡Œé¢å® ç‰©åº”ç”¨ (Electron)"]
        Main["ä¸»è¿›ç¨‹<br/>main.ts"]
        Preload["é¢„åŠ è½½<br/>preload.ts"]
        
        subgraph Renderer["æ¸²æŸ“è¿›ç¨‹"]
            Live2D["Live2D ç®¡ç†å™¨<br/>live2d-manager.ts"]
            Backend["åç«¯é€šä¿¡<br/>backend-client.ts"]
            Dialogue["å¯¹è¯ç®¡ç†<br/>dialogue-manager.ts"]
            Audio["éŸ³é¢‘æ’­æ”¾<br/>audio-player.ts"]
            Security["å®‰å…¨æ¨¡å—<br/>auth & crypto"]
            UI["UI äº¤äº’<br/>renderer.ts"]
        end
    end
    
    subgraph Server["åç«¯ Agent æœåŠ¡å™¨"]
        AI["AI å¯¹è¯å¤„ç†"]
        TTS["è¯­éŸ³åˆæˆ"]
        Control["åŠ¨ä½œæ§åˆ¶å†³ç­–"]
    end
    
    Main -->|IPC| Preload
    Preload -->|å®‰å…¨æ¡¥æ¥| Renderer
    UI --> Live2D
    UI --> Backend
    UI --> Dialogue
    UI --> Audio
    Backend -->|WebSocket/HTTP| Server
    Server -->|å“åº”| Backend
    Backend -->|å¯¹è¯| Dialogue
    Backend -->|è¯­éŸ³| Audio
    Backend -->|åŠ¨ä½œæŒ‡ä»¤| Live2D
    
    style Desktop fill:#e1f5ff
    style Renderer fill:#fff4e1
    style Server fill:#ffe1f0
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
NyaDeskPet/
â”œâ”€â”€ src/                    # TypeScript æºç ï¼ˆä¸»è¿›ç¨‹ï¼‰
â”‚   â”œâ”€â”€ main.ts            # Electron ä¸»è¿›ç¨‹ï¼Œè´Ÿè´£çª—å£ç®¡ç†å’Œ IPC
â”‚   â””â”€â”€ preload.ts         # é¢„åŠ è½½è„šæœ¬ï¼Œå®‰å…¨çš„ IPC æ¡¥æ¥
â”œâ”€â”€ dist/                   # ç¼–è¯‘åçš„ JSï¼ˆä¸»è¿›ç¨‹ï¼‰
â”œâ”€â”€ renderer/               # æ¸²æŸ“è¿›ç¨‹
â”‚   â”œâ”€â”€ index.html         # ä¸»é¡µé¢å…¥å£
â”‚   â”œâ”€â”€ styles.css         # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ global.d.ts    # å…¨å±€æ¥å£å’Œç±»å‹å®šä¹‰
â”‚   â””â”€â”€ js/                # æ¸²æŸ“è¿›ç¨‹æ ¸å¿ƒæ¨¡å—
â”‚       â”œâ”€â”€ renderer.ts        # ä¸»åè°ƒè„šæœ¬ï¼Œåˆå§‹åŒ–åº”ç”¨
â”‚       â”œâ”€â”€ settings-manager.ts  # è®¾ç½®ç®¡ç†å™¨ï¼Œé…ç½®å­˜å‚¨å’Œè¯»å–
â”‚       â”œâ”€â”€ live2d-manager.ts  # Live2D æ¨¡å‹åŠ è½½ã€æ¸²æŸ“å’ŒåŠ¨ç”»æ§åˆ¶
â”‚       â”œâ”€â”€ backend-client.ts  # WebSocket/HTTP åç«¯é€šä¿¡
â”‚       â”œâ”€â”€ dialogue-manager.ts# å¯¹è¯æ¡†å’Œæ–‡æœ¬å±•ç¤º
â”‚       â””â”€â”€ audio-player.ts    # éŸ³é¢‘æ’­æ”¾å’Œ TTS æ”¯æŒ
â”œâ”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md              # æ¥å£åè®®è§„èŒƒ
â”‚   â”œâ”€â”€ USAGE.md            # å®‰è£…å’Œä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ DEVELOPMENT.md      # å¼€å‘ç»†èŠ‚ï¼ˆæœ¬æ–‡æ¡£ï¼‰
â”œâ”€â”€ models/                # æœ¬åœ°æµ‹è¯•æ¨¡å‹æ–‡ä»¶
â”œâ”€â”€ assets/                # å›¾æ ‡å’Œé™æ€èµ„æº
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®å’Œä¾èµ–
â””â”€â”€ tsconfig.json          # TypeScript ç¼–è¯‘é…ç½®
```

---
## ğŸ¨ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### è®¾ç½®ç®¡ç†å™¨ (settings-manager.ts)

è´Ÿè´£åº”ç”¨é…ç½®çš„æŒä¹…åŒ–å­˜å‚¨å’Œç®¡ç†ï¼š

- **å­˜å‚¨æ–¹å¼**: localStorage
- **é…ç½®é¡¹**: æ¨¡å‹è·¯å¾„ã€åç«¯URLã€è‡ªåŠ¨è¿æ¥ã€éŸ³é‡ç­‰
- **éªŒè¯**: è‡ªåŠ¨éªŒè¯é…ç½®æœ‰æ•ˆæ€§ï¼ˆURLæ ¼å¼ã€è·¯å¾„ç­‰ï¼‰
- **API**: æä¾› get/set/update/reset ç­‰æ“ä½œ
- **UIé›†æˆ**: ä¸è®¾ç½®é¢æ¿åŒå‘ç»‘å®š

### Live2D ç®¡ç†å™¨ (live2d-manager.ts)

è´Ÿè´£ Live2D æ¨¡å‹çš„åŠ è½½å’Œæ¸²æŸ“ï¼š

- **ä¾èµ–**: PixiJS 7.3 + Live2D Cubism SDK
- **åŠŸèƒ½**: æ¨¡å‹åŠ è½½ã€åŠ¨ç”»æ’­æ”¾ã€è¡¨æƒ…æ§åˆ¶ã€è§†çº¿è·Ÿéš
- **çŠ¶æ€ç®¡ç†**: å½“å‰åŠ¨ä½œã€è¡¨æƒ…çŠ¶æ€è¿½è¸ª

### åç«¯é€šä¿¡å®¢æˆ·ç«¯ (backend-client.ts)

WebSocket å’Œ HTTP åŒåè®®æ”¯æŒï¼š

- **WebSocket**: å®æ—¶åŒå‘é€šä¿¡
- **HTTP**: Fallback å’Œ REST API è°ƒç”¨
- **è‡ªåŠ¨é‡è¿**: æ–­çº¿åè‡ªåŠ¨é‡è¿æœºåˆ¶
- **é…ç½®çƒ­æ›´æ–°**: ä»è®¾ç½®ç®¡ç†å™¨è¯»å–æœ€æ–°é…ç½®

---
##  æŠ€æœ¯æ ˆ

- **Electron 28.0**: åº”ç”¨å¤–å£³ã€‚
- **TypeScript 5.3**: å¼€å‘è¯­è¨€ã€‚
- **PixiJS 7.3**: 2D æ¸²æŸ“å¼•æ“ï¼Œç”¨äºæ‰¿è½½ Live2D ç”»å¸ƒã€‚
- **Live2D Cubism SDK**: Live2D åŸç”Ÿæ”¯æŒå±‚ã€‚
- **Web Crypto API**: ç”¨äºæœ¬åœ°é«˜æ€§èƒ½åŠ è§£å¯†ã€‚
- **IndexedDB**: ç”¨äºå­˜å‚¨å¤§æ•°æ®å—ï¼ˆ10MB+ æ¨¡å‹ï¼‰ã€‚

---

## ğŸ› ï¸ åç»­å¼€å‘

### æ·»åŠ æ–°æ¨¡å—

1. åœ¨ `renderer/js/` åˆ›å»ºæ–° `.ts` æ–‡ä»¶ã€‚
2. åœ¨ `renderer/types/global.d.ts` å®šä¹‰æ¥å£å’Œ `Window` æ‰©å±•ã€‚
3. åœ¨ `renderer/index.html` ä¸­å¼•å…¥ç¼–è¯‘åçš„ `.js` æ–‡ä»¶ã€‚
4. åœ¨ `renderer.ts` çš„åˆå§‹åŒ–é€»è¾‘ä¸­å¯åŠ¨ã€‚

### æ ¸å¿ƒåŠŸèƒ½è¿­ä»£è®¡åˆ’

- [ ] å®ç° Live2D è§†çº¿è·Ÿéšé¼ æ ‡ã€‚
- [ ] å¢åŠ è‡ªå®šä¹‰å¿«æ·é”®ã€‚
- [ ] ç³»ç»Ÿæ‰˜ç›˜å¿«é€Ÿäº¤äº’èœå•ã€‚
- [ ] ä¼˜åŒ–æ¨¡å‹åˆ‡æ¢æ—¶çš„å†…å­˜é‡Šæ”¾ã€‚
- [ ] å¢åŠ å¼€æœºè‡ªå¯åŠ¨é…ç½®é¡¹ã€‚

---

**æ³¨æ„**: æœ¬é¡¹ç›®å·²å»ºç«‹ä¸¥æ ¼çš„æ–‡æ¡£è§„èŒƒã€‚åç»­å¼€å‘ç»†èŠ‚è¯·åœ¨æ­¤æ–‡æ¡£å†…æ›´æ–°ï¼Œä¸¥ç¦åˆ›å»ºæ–°çš„æ–‡æ¡£ã€‚
