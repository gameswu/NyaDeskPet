<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NyaDeskPet</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- 顶栏（可拖动区域） -->
  <div id="top-bar" class="top-bar">
    <div class="status-section">
      <div id="status-indicator" class="status-dot disconnected"></div>
      <span id="status-text" class="status-text" data-i18n="topBar.disconnected">未连接</span>
    </div>
    <div class="controls-section">
      <button id="btn-settings" class="top-bar-btn" data-i18n-title="topBar.settings">
        <i data-lucide="settings"></i>
      </button>
      <button id="btn-minimize" class="top-bar-btn" data-i18n-title="topBar.minimize">
        <i data-lucide="minus"></i>
      </button>
      <button id="btn-close" class="top-bar-btn" data-i18n-title="topBar.close">
        <i data-lucide="x"></i>
      </button>
    </div>
  </div>

  <!-- 主内容区域（Live2D 模型） -->
  <div id="main-content">
    <!-- Live2D 画布容器 -->
    <div id="live2d-container">
      <canvas id="live2d-canvas"></canvas>
    </div>

    <!-- 对话框（模型说话显示） -->
    <div id="dialogue-box" class="hidden">
      <div id="dialogue-text"></div>
      <div id="dialogue-progress"></div>
    </div>

    <!-- 交互区域 -->
    <div id="interaction-area"></div>
  </div>

  <!-- 底栏 -->
  <div id="bottom-bar" class="bottom-bar">
    <button id="btn-open-chat" class="chat-btn" data-i18n-title="bottomBar.openChat">
      <i data-lucide="message-circle"></i>
    </button>
  </div>

  <!-- UI切换按钮 -->
  <button id="btn-toggle-ui" class="toggle-ui-btn" data-i18n-title="app.toggleUI">
    <i data-lucide="eye-off"></i>
  </button>

  <!-- 对话窗口 -->
  <div id="chat-window" class="chat-window hidden">
    <div class="chat-header">
      <h3>
        <i data-lucide="message-square" style="width: 18px; height: 18px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
        <span data-i18n="chatWindow.title">对话</span>
      </h3>
      <button id="btn-close-chat" class="btn-icon" data-i18n-title="chatWindow.close">
        <i data-lucide="x"></i>
      </button>
    </div>
    <div class="chat-body">
      <div id="chat-messages" class="chat-messages">
        <!-- 消息将动态添加到这里 -->
      </div>
      <div class="chat-input-area">
        <div class="input-controls">
          <button id="btn-voice" class="input-btn" data-i18n-title="chatWindow.voice">
            <i data-lucide="mic"></i>
            <span class="btn-label" data-i18n="chatWindow.voice">语音输入</span>
          </button>
          <button id="btn-camera" class="input-btn" data-i18n-title="chatWindow.camera">
            <i data-lucide="video"></i>
            <span class="btn-label" data-i18n="chatWindow.camera">摄像头</span>
          </button>
        </div>
        <div class="input-wrapper">
          <textarea id="chat-input" data-i18n-placeholder="chatWindow.placeholder" placeholder="输入消息..." rows="1"></textarea>
          <button id="btn-send" class="send-btn" data-i18n="chatWindow.send">发送</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 设置面板 -->
  <div id="settings-panel" class="settings-panel">
    <div class="settings-content">
      <div class="settings-header">
        <h2>
          <i data-lucide="settings" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
          <span data-i18n="settings.title">设置</span>
        </h2>
        <button id="btn-close-settings" class="btn-icon" data-i18n-title="settings.close">
          <i data-lucide="x"></i>
        </button>
      </div>
      
      <div class="settings-body">
        <!-- 模型设置 -->
        <div class="settings-section">
          <h3>
            <i data-lucide="smile" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;"></i>
            <span data-i18n="settings.model.title">Live2D 模型</span>
          </h3>
          <div class="setting-item">
            <label for="setting-model-path" data-i18n="settings.model.path">模型路径</label>
            <div class="input-with-button">
              <input type="text" id="setting-model-path" data-i18n-placeholder="settings.model.pathPlaceholder" placeholder="../models/default/model3.json" readonly>
              <button id="btn-browse-model" class="btn-browse" data-i18n-title="settings.model.browse">
                <i data-lucide="folder-open"></i>
              </button>
            </div>
            <small data-i18n="settings.model.hint">点击浏览按钮选择 model3.json 或 model.json 文件</small>
          </div>
        </div>

        <!-- 后端连接设置 -->
        <div class="settings-section">
          <h3>
            <i data-lucide="globe" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;"></i>
            <span data-i18n="settings.backend.title">后端连接</span>
          </h3>
          <div class="setting-item">
            <label>
              <input type="checkbox" id="setting-auto-connect">
              <span data-i18n="settings.backend.autoConnect">启动时自动连接后端</span>
            </label>
          </div>
          <div class="setting-item">
            <label for="setting-backend-url" data-i18n="settings.backend.httpUrl">HTTP 地址</label>
            <input type="text" id="setting-backend-url" data-i18n-placeholder="settings.backend.httpPlaceholder" placeholder="http://localhost:8000">
          </div>
          <div class="setting-item">
            <label for="setting-websocket-url" data-i18n="settings.backend.wsUrl">WebSocket 地址</label>
            <input type="text" id="setting-websocket-url" data-i18n-placeholder="settings.backend.wsPlaceholder" placeholder="ws://localhost:8000/ws">
          </div>
        </div>

        <!-- 音频设置 -->
        <div class="settings-section">
          <h3>
            <i data-lucide="volume-2" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;"></i>
            <span data-i18n="settings.audio.title">音频</span>
          </h3>
          <div class="setting-item">
            <label for="setting-volume"><span data-i18n="settings.audio.volume">音量</span> <span id="volume-value">80%</span></label>
            <input type="range" id="setting-volume" min="0" max="1" step="0.01" value="0.8">
          </div>
        </div>

        <!-- 外观设置 -->
        <div class="settings-section">
          <h3>
            <i data-lucide="palette" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;"></i>
            <span data-i18n="settings.appearance.title">外观</span>
          </h3>
          <div class="setting-item">
            <label for="setting-language" data-i18n="settings.appearance.language">语言</label>
            <select id="setting-language">
              <option value="zh-CN">简体中文</option>
              <option value="en-US">English</option>
            </select>
          </div>
          <div class="setting-item">
            <label for="setting-theme" data-i18n="settings.appearance.theme">主题</label>
            <select id="setting-theme">
              <option value="light">明亮</option>
              <option value="dark">暗黑</option>
              <option value="system">跟随系统</option>
            </select>
          </div>
        </div>

        <!-- 关于 & 更新 -->
        <div class="settings-section">
          <h3>
            <i data-lucide="info" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;"></i>
            <span data-i18n="settings.about.title">关于</span>
          </h3>
          <div class="setting-item about-info">
            <span><span data-i18n="settings.about.version">版本</span>: <span id="app-version">1.0.0</span></span>
            <button id="btn-check-update" class="btn-small">
              <i data-lucide="refresh-cw" style="width: 14px; height: 14px;"></i>
              <span data-i18n="settings.about.checkUpdate">检查更新</span>
            </button>
          </div>
          <div class="setting-item">
            <label for="setting-update-source" data-i18n="settings.about.updateSource">更新源</label>
            <input type="text" id="setting-update-source" data-i18n-placeholder="settings.about.updateSourcePlaceholder" placeholder="https://github.com/owner/repo">
            <small data-i18n="settings.about.updateSourceHint">GitHub 仓库地址，用于检查更新</small>
          </div>
          <div id="update-status" class="update-status hidden"></div>
        </div>
      </div>

      <div class="settings-footer">
        <button id="btn-reset-settings" class="btn-secondary" data-i18n="settings.resetButton">恢复默认</button>
        <button id="btn-save-settings" class="btn-primary" data-i18n="settings.saveButton">保存设置</button>
      </div>
    </div>
  </div>

  <!-- 脚本引入 -->
  <script src="lib/pixi.min.js"></script>
  <!-- Cubism 4 Core 运行时（必须在 pixi-live2d-display 之前加载） -->
  <script src="lib/live2dcubismcore.min.js"></script>
  <!-- pixi-live2d-display Cubism 4 支持 -->
  <script src="lib/pixi-live2d-cubism4.min.js"></script>
  <!-- Lucide Icons 图标库 -->
  <script src="lib/lucide.min.js"></script>
  <!-- TypeScript 编译后的 JavaScript 文件 -->
  <script type="module" src="js/i18n-manager.js"></script>
  <script type="module" src="js/theme-manager.js"></script>
  <script type="module" src="js/settings-manager.js"></script>
  <script type="module" src="js/live2d-manager.js"></script>
  <script type="module" src="js/backend-client.js"></script>
  <script type="module" src="js/dialogue-manager.js"></script>
  <script type="module" src="js/audio-player.js"></script>
  <script type="module" src="js/renderer.js"></script>

  <!-- 初始化 Lucide Icons -->
  <script>
    // 等待 DOM 加载完成后创建所有图标
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>
