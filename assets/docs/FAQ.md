# 常见问题

---

## 安装与启动

### Q：首次启动出现安全警告怎么办？

**Windows：** Windows Defender SmartScreen 可能阻止运行。点击「更多信息」→「仍要运行」。

**macOS：** 系统可能提示"无法验证开发者"。前往 **系统设置 → 隐私与安全性**，找到 NyaDeskPet 并点击「仍要打开」。

### Q：启动后看不到角色？

- 检查窗口是否被其他应用遮挡，可通过系统托盘菜单选择「显示」
- 窗口可能在屏幕外。尝试：托盘菜单 → 显示，或重启应用

---

## 模型相关

### Q：Live2D 模型无法加载？

1. **检查路径**：确认 `.model3.json` 文件路径正确
2. **检查文件完整性**：模型目录需包含 `.moc3`、纹理等文件
3. **格式兼容**：NyaDeskPet 支持 **Cubism 4** 格式，不支持 Cubism 2/3
4. **查看日志**：在设置中启用日志，查看详细错误信息

### Q：模型显示异常（黑块、变形）？

- 纹理文件可能损坏，重新下载或解压模型
- 某些模型可能使用了不支持的扩展特性

---

## AI 对话

### Q：角色不回复消息？

1. **检查 LLM 供应商**：确认已添加至少一个 LLM 供应商并设为主供应商
2. **检查 API Key**：确认 API Key 有效且有余额
3. **检查连接状态**：确认后端 Agent 已启动且连接成功
4. **检查网络**：LLM API 需要网络访问

### Q：AI 回复很慢？

- 不同模型和供应商的响应速度不同
- 检查网络连接质量
- 尝试更换供应商或使用更快的模型

### Q：如何清除对话历史？

- 点击 **对话按钮** 打开侧边栏
- 创建新对话，或删除旧对话
- 对话历史存储在本地 SQLite 数据库中

---

## 语音识别

### Q：麦克风按钮灰色不可用？

1. **检查 FFmpeg**：终端运行 `ffmpeg -version` 确认已安装
2. **检查模型文件**：确认 `models/asr/sense-voice-small/` 下有 `model.onnx` 和 `tokens.txt`
3. **检查系统权限**：确认应用拥有麦克风访问权限

### Q：语音识别不准确？

- 在安静环境中使用
- 适当调低音量阈值
- 靠近麦克风说话
- 说话语速适中，发音清晰

### Q：如何在嘈杂环境中使用语音？

调高 **设置 → 连接 → 音量阈值**，过滤环境噪音。默认值为 30，嘈杂环境可调至 50-70。

---

## 插件

### Q：插件启动失败？

1. **检查依赖**：确认 Python 等运行环境已安装
2. **查看终端输出**：插件进程的错误信息
3. **检查端口**：插件使用的端口是否被占用
4. **权限问题**：macOS/Linux 确认启动脚本有执行权限

### Q：工具调用确认弹窗太频繁？

- `low` 和 `medium` 等级的权限可以勾选「记住选择」
- `high` 和 `critical` 等级的操作出于安全考虑必须每次确认

### Q：如何卸载第三方插件？

1. 在插件面板中停止插件
2. 删除 `plugins/` 或 `agent-plugins/` 下对应的插件目录
3. 重启应用

---

## 显示与界面

### Q：如何切换深色/浅色主题？

在 **设置 → 显示 → 主题** 中选择：明亮、暗黑 或 跟随系统。

### Q：如何切换语言？

在 **设置 → 显示 → 语言** 中选择：简体中文 或 English。

### Q：如何让桌宠一直在最前面？

通过系统托盘菜单 → 勾选「窗口置顶」。

### Q：如何隐藏 UI 只留角色？

三种方式：
1. **双击** Live2D 角色
2. 点击底栏的 **👁️ 按钮**
3. 系统托盘菜单 → UI 切换

---

## 更新

### Q：更新后设置会丢失吗？

不会。设置、对话历史、插件配置都保存在用户数据目录中，更新应用不会影响这些数据。

### Q：无法连接到更新服务器？

- 检查网络连接
- 如果无法访问 GitHub，可以在 **设置 → 关于** 中修改更新源地址
- 也可以手动下载新版本安装

---

## 性能

### Q：应用占用内存过高？

- Live2D 模型和纹理会占用一定内存
- 长时间对话积累的历史也会增加内存使用
- 创建新对话可以释放部分内存
- ASR 模型（约 200MB）仅在使用语音识别时加载

### Q：开机自启后注意事项？

在 **设置 → 显示** 中开启「开机自启」后，应用会在系统启动时自动运行。如果同时配置了自动连接，Agent 服务器也会自动启动。

---

## 其他

### Q：数据存储在哪里？

| 数据 | 位置 |
|------|------|
| 应用设置 | 浏览器 localStorage |
| 对话历史 | 用户数据目录下的 SQLite 数据库 |
| 插件配置 | 用户数据目录 |
| 插件权限 | 用户数据目录下的 `plugin-permissions.json` |
| 日志文件 | 用户数据目录下的 `logs/` |

### Q：如何反馈 Bug 或建议？

前往 GitHub Issues 页面提交。提交时请附上：
1. 操作系统和版本
2. NyaDeskPet 版本号
3. 问题复现步骤
4. 相关日志（如有）

### Q：如何支持项目？

- ⭐ 在 GitHub 上给项目 Star
- 🐛 提交 Bug 报告和功能建议
- 🔌 开发和分享插件
- 📖 帮助完善文档
