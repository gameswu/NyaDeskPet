# Live2D 模型配置

NyaDeskPet 支持 Live2D Cubism 3 及以上版本模型作为桌面角色。你可以使用自带的默认模型，也可以加载自己的模型。

## 目录
- [Live2D 模型配置](#live2d-模型配置)
  - [目录](#目录)
  - [选择模型](#选择模型)
    - [通过设置面板选择](#通过设置面板选择)
    - [手动放置模型文件](#手动放置模型文件)
  - [模型文件结构](#模型文件结构)
  - [模型交互](#模型交互)
    - [缩放](#缩放)
    - [拖拽移动](#拖拽移动)
    - [视线跟随](#视线跟随)
  - [触碰配置](#触碰配置)
    - [配置触碰区域](#配置触碰区域)
  - [参数映射表](#参数映射表)
    - [文件位置](#文件位置)
    - [文件格式](#文件格式)
  - [显示模式](#显示模式)
  - [下一步](#下一步)

---

## 选择模型

### 通过设置面板选择

<div align="center">
    <img src="./images/model-select.png" alt="模型选择界面" width="300"/>
</div>

1. 点击顶栏的 **设置按钮**
2. 在 **模型** 标签页中，点击 **选择文件** 按钮
3. 选择模型的 `.model3.json` 文件
4. 点击 **保存设置**，模型会自动加载

### 手动放置模型文件

你也可以直接将模型文件夹放入应用的 `models/` 目录中，然后在设置中填写相应路径。

---

## 模型文件结构

一个标准的 Live2D Cubism 3 模型包含以下文件：

```
my-model/
├── my-model.model3.json    ← 入口文件（选择这个）
├── my-model.moc3            ← 模型数据
├── my-model.cdi3.json       ← 展示信息
├── my-model.physics3.json   ← 物理演算
├── expressions/              ← 表情文件
│   ├── exp_01.exp3.json
│   └── ...
├── motions/                  ← 动作文件
│   ├── mtn_01.motion3.json
│   └── ...
└── my-model.8192/            ← 纹理目录
    └── texture_00.png
```

> [!TIP]
> 只需指向 `.model3.json` 文件，应用会自动找到同目录下的其他资源。

---

## 模型交互

### 缩放

- 使用 **鼠标滚轮** 缩放模型
- 缩放范围：0.3x ~ 3.0x
- 缩放比例会自动保存

### 拖拽移动

- 拖拽 **顶栏** 可以移动整个窗口
- 模型位置跟随窗口

### 视线跟随

在 **设置 → 显示** 中可以开启/关闭「视线跟随」功能。开启后，角色的视线会跟随鼠标移动。

---

## 触碰配置

点击模型不同部位会触发不同的触碰事件，角色会通过 AI 生成相应反应。

### 配置触碰区域

1. 打开 **设置 → 模型** 标签页
2. 在 **触碰反应配置** 区域，你会看到模型支持的所有触碰区域
3. 使用开关启用/禁用特定区域的触碰反应

> [!TIP]
> 可用的触碰区域取决于模型本身的设定。不同模型可能有不同的触碰区域。

---

## 参数映射表

参数映射表（`param-map.json`）为 AI 提供了模型参数的语义信息，使 AI 能理解如何控制模型的表情和动作。

### 文件位置

将 `param-map.json` 放在模型的 `.model3.json` 同级目录下：

```
my-model/
├── my-model.model3.json
├── param-map.json          ← 参数映射表
└── ...
```

### 文件格式

```json
{
  "parameters": [
    {
      "id": "ParamEyeLOpen",
      "alias": "left_eye_open",
      "description": "左眼开合程度，0 为闭眼，1 为睁眼"
    },
    {
      "id": "ParamMouthOpenY",
      "alias": "mouth_open",
      "description": "嘴巴张开程度"
    }
  ],
  "expressions": [
    {
      "file": "expressions/exp_01.exp3.json",
      "alias": "happy",
      "description": "开心的表情"
    }
  ],
  "motions": [
    {
      "group": "Idle",
      "index": 0,
      "alias": "wave",
      "description": "挥手打招呼动作"
    }
  ]
}
```

| 字段 | 说明 |
|------|------|
| `parameters` | 模型参数的语义别名和描述，帮助 AI 理解参数含义 |
| `expressions` | 表情文件的别名和描述 |
| `motions` | 动作分组和索引的别名和描述 |

> [!TIP]
> 参数映射表不是必需的，但有了它 AI 能更准确地控制模型。模型加载后，完整的参数信息（含映射表）会自动发送给后端。

---

## 显示模式

NyaDeskPet 支持两种显示模式：

| 模式 | 说明 | 切换方式 |
|------|------|---------|
| 完整 UI | 显示顶栏、底栏、对话区域 | 默认模式 |
| 纯模型 | 只显示 Live2D 角色 | 底栏按钮 / 托盘菜单 |

---

## 下一步

- 需要语音输入？查看 [ASR 配置](ASRConfig.md)
- 准备开始对话？查看 [对话](Conversation.md)
