# 权限审批

NyaDeskPet 的前端插件在执行敏感操作时需要你的授权。权限系统确保插件不会在未经你同意的情况下进行危险操作。

## 目录
- [权限审批](#权限审批)
  - [目录](#目录)
  - [权限等级](#权限等级)
  - [审批流程](#审批流程)
    - [1. 弹出确认对话框](#1-弹出确认对话框)
    - [2. 做出决定](#2-做出决定)
    - [3. 记住选择（可选）](#3-记住选择可选)
  - [工具调用确认](#工具调用确认)
  - [内置插件权限参考](#内置插件权限参考)
    - [终端控制插件](#终端控制插件)
    - [UI 自动化插件](#ui-自动化插件)
    - [文件编辑器插件](#文件编辑器插件)
  - [管理已授权权限](#管理已授权权限)
  - [安全建议](#安全建议)
  - [下一步](#下一步)

---

## 权限等级

插件的每个权限都有一个 **危险等级**，决定了审批策略：

| 等级 | 颜色 | 确认策略 | 说明 |
|------|------|---------|------|
| <font color="green">safe</font> | 绿色 | 自动允许 | 无风险操作，无需确认 |
| <font color="blue">low</font> | 蓝色 | 首次确认 | 低风险，首次弹窗后可记住选择 |
| <font color="yellow">medium</font> | 黄色 | 首次确认 | 中等风险，首次弹窗后可记住选择 |
| <font color="orange">high</font> | 橙色 | 每次确认 | 高风险，每次执行都弹窗确认 |
| <font color="red">critical</font> | 红色 | 每次确认 | 极高风险，每次都需显式授权 |

---

## 审批流程

当插件请求执行需要权限的操作时：

### 1. 弹出确认对话框

<div align="center">
    <img src="./images/perm-dialog.png" alt="权限请求对话框示例" width="300"/>
</div>

对话框显示以下信息：
- **插件名称**：哪个插件在请求
- **权限名称**：请求的具体权限
- **操作描述**：这次要做什么
- **危险等级**：用颜色标识风险程度

### 2. 做出决定

你有两个选择：
- ✅ **允许**：授权本次操作
- ❌ **拒绝**：拒绝本次操作

### 3. 记住选择（可选）

对于 `low` 和 `medium` 等级的权限，你可以勾选 **「记住此选择」**：
- 勾选后，同一插件的同一权限不会再次弹窗
- `high` 和 `critical` 等级的权限 **始终** 需要每次确认

---

## 工具调用确认

<div align="center">
    <img src="./images/perm-tool-confirm.png" alt="工具调用确认窗口示例" width="300"/>
</div>

当 AI 要调用来自前端插件的工具时，也会弹出确认窗口。窗口显示：

- **工具名称**：AI 要调用的工具
- **调用参数**：具体的参数内容
- **来源插件**：工具属于哪个插件

详细参数较多时，窗口支持 **折叠显示**，点击可展开查看完整内容。

> [!TIP]
> 来自 Agent 插件注册的内置工具（如 `fetch_url`、`search_web`）不需要用户确认，只有前端插件的工具需要确认。

---

## 内置插件权限参考

### 终端控制插件

| 权限 ID | 名称 | 危险等级 |
|---------|------|---------|
| `terminal.execute` | 执行终端命令 | <font color="orange">high</font> |
| `terminal.session` | 管理 Shell 会话 | <font color="yellow">medium</font> |

### UI 自动化插件

| 权限 ID | 名称 | 危险等级 |
|---------|------|---------|
| `ui-automation.mouse` | 鼠标控制 | <font color="orange">high</font> |
| `ui-automation.keyboard` | 键盘控制 | <font color="orange">high</font> |
| `ui-automation.screen` | 屏幕截图 | <font color="yellow">medium</font> |

### 文件编辑器插件

| 权限 ID | 名称 | 危险等级 |
|---------|------|---------|
| `file.read` | 读取文件 | <font color="blue">low</font> |
| `file.write` | 创建文件 | <font color="yellow">medium</font> |
| `file.edit` | 编辑文件 | <font color="yellow">medium</font> |

---

## 管理已授权权限

已授权的权限记录保存在用户数据目录的 `plugin-permissions.json` 中。如果你想撤销之前授予的权限，可以：

1. 删除或编辑 `plugin-permissions.json` 文件
2. 重启应用后，插件会重新请求权限

---

## 安全建议

- 🔍 **仔细阅读**：审批前认真阅读操作描述，了解插件要做什么
- ⚠️ **谨慎授权**：对于 high/critical 等级的操作，确认确实需要后再授权
- 🔄 **定期检查**：定期检查已授权的权限，撤销不再需要的授权
- 📦 **信任来源**：只使用来自可信来源的插件

---

## 下一步

- 了解如何管理 Agent 插件：[内置 Agent 管理](AgentManagement.md)
- 返回查看内置插件详情：[启用内置插件](BuiltInPlugins.md)
