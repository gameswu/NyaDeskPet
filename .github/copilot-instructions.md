# NyaDeskPet - Electron + Live2D æ¡Œé¢å® ç‰©é¡¹ç›®

## é¡¹ç›®æ–‡æ¡£

**ä¸»æ–‡æ¡£**ï¼šREADME.md

**æ ¸å¿ƒæ–‡æ¡£åº“**ï¼š
- `docs/API.md`ï¼šAPI æ¥å£è§„èŒƒä¸é€šä¿¡åè®®
- `docs/USAGE.md`ï¼šç”¨æˆ·æŒ‡å—ã€å®‰è£…è¯´æ˜ã€æ‰“åŒ…ä¸æ•…éšœæ’é™¤
- `docs/DEVELOPMENT.md`ï¼šæ¶æ„è®¾è®¡ã€æ ¸å¿ƒé€»è¾‘æ·±åº¦è§£æ
- `docs/PLUGINS.md`ï¼šå‰ç«¯æ’ä»¶å¼€å‘æŒ‡å—
- `docs/AGENT_PLUGINS.md`ï¼šå†…ç½® Agent æ’ä»¶å¼€å‘æŒ‡å—

**æ–‡æ¡£åŸåˆ™**ï¼šä¸¥ç¦åœ¨ `docs/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡æ¡£ã€‚æ‰€æœ‰æ›´æ–°å¿…é¡»åœ¨ä¸Šè¿°äº”ä¸ªç°æœ‰æ–‡æ¡£ï¼ˆæˆ– README.mdï¼‰ä¸­è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ã€‚

## é¡¹ç›®æ¦‚è¿°

è·¨å¹³å°æ¡Œé¢å® ç‰©åº”ç”¨ï¼Œä½¿ç”¨ Electron + Live2D + TypeScriptï¼Œé€šè¿‡ WebSocket ä¸åç«¯ Agent æœåŠ¡å™¨å®æ—¶é€šä¿¡ã€‚

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šElectron 28.0
- **å¼€å‘è¯­è¨€**ï¼šTypeScript 5.3
- **æ¸²æŸ“å¼•æ“**ï¼šPixiJS 7.3
- **Live2D**ï¼šCubism SDK for Web
- **é€šä¿¡**ï¼šWebSocketï¼ˆå®æ—¶é€šä¿¡ï¼‰
- **éŸ³é¢‘**ï¼šMediaSource Extensionsï¼ˆMSE æµå¼æ’­æ”¾ï¼‰
- **è¯­éŸ³è¯†åˆ«**ï¼šSherpa-ONNXï¼ˆæœ¬åœ° ASRï¼‰

## æ¶æ„è®¾è®¡

### ä¸»è¦è¿›ç¨‹

- **ä¸»è¿›ç¨‹**ï¼šElectronï¼ˆsrc/main.ts â†’ dist/main.jsï¼‰
- **é¢„åŠ è½½**ï¼šå®‰å…¨çš„ IPC æ¡¥æ¥ï¼ˆsrc/preload.ts â†’ dist/preload.jsï¼‰

### æ¸²æŸ“è¿›ç¨‹æ¨¡å—

- **Live2D ç®¡ç†å™¨**ï¼ˆrenderer/js/live2d-manager.tsï¼‰
  - æ¨¡å‹æ¸²æŸ“ã€åŠ¨ä½œã€è¡¨æƒ…ã€å‚æ•°æ§åˆ¶
  - è§†çº¿è·Ÿéšã€è§¦ç¢°äº¤äº’
  
- **åç«¯é€šä¿¡å®¢æˆ·ç«¯**ï¼ˆrenderer/js/backend-client.tsï¼‰
  - WebSocket æ¶ˆæ¯å¤„ç†
  - HTTP è¯·æ±‚å¤„ç†
  
- **å¯¹è¯ç®¡ç†å™¨**ï¼ˆrenderer/js/dialogue-manager.tsï¼‰
  - æ–‡å­—å¯¹è¯æ˜¾ç¤º
  - å¯¹è¯å†å²è®°å½•
  
- **éŸ³é¢‘æ’­æ”¾å™¨**ï¼ˆrenderer/js/audio-player.tsï¼‰
  - æµå¼éŸ³é¢‘æ’­æ”¾
  - æ—¶é—´è½´åŒæ­¥
  - å£å‹åŒæ­¥
  
- **è®¾ç½®ç®¡ç†å™¨**ï¼ˆrenderer/js/settings-manager.tsï¼‰
  - é…ç½®æŒä¹…åŒ–
  - è®¾ç½®éªŒè¯
  
- **ä¸»åè°ƒè„šæœ¬**ï¼ˆrenderer/js/renderer.tsï¼‰
  - åˆå§‹åŒ–ä¸äº‹ä»¶åè°ƒ

- **æ’ä»¶è¿æ¥å™¨**ï¼ˆrenderer/js/plugin-connector.tsï¼‰
  - æ’ä»¶è¿›ç¨‹ç®¡ç†
  - WebSocket è¿æ¥ç®¡ç†
  - æ’ä»¶çŠ¶æ€åŒæ­¥

- **æ’ä»¶ UI**ï¼ˆrenderer/js/plugin-ui.tsï¼‰
  - æ’ä»¶å¡ç‰‡æ¸²æŸ“
  - ç°ä»£åŒ– UI è®¾è®¡

### ç±»å‹å®šä¹‰

- `renderer/types/global.d.ts`ï¼šå…¨å±€æ¥å£å’Œç±»å‹å®šä¹‰

## æ ¸å¿ƒç‰¹æ€§

### Live2D æ§åˆ¶ç³»ç»Ÿ

**é¢„è®¾ç³»ç»Ÿ**ï¼š
- åŠ¨ä½œï¼ˆmotionï¼‰ï¼šéœ€æ¨¡å‹æ–‡ä»¶é¢„å®šä¹‰çš„åŠ¨ç”»åºåˆ—
- è¡¨æƒ…ï¼ˆexpressionï¼‰ï¼šéœ€æ¨¡å‹æ–‡ä»¶é¢„å®šä¹‰çš„è¡¨æƒ…çŠ¶æ€

**å‚æ•°ç›´æ¥æ§åˆ¶**ï¼š
- Agent å¯é€šè¿‡ `setParameter()` ç›´æ¥æ§åˆ¶ä»»æ„å‚æ•°
- æ”¯æŒæ§åˆ¶çœ¼ç›ã€å˜´å·´ã€å¤´éƒ¨æ—‹è½¬ã€çœ‰æ¯›ç­‰
- ä¸ä¾èµ–é¢„è®¾æ–‡ä»¶ï¼Œå¯è‡ªç”±ç»„åˆåˆ›é€ è¡¨æƒ…

**äº¤äº’åŠŸèƒ½**ï¼š
- è§†çº¿è·Ÿéšï¼šé¼ æ ‡ç§»åŠ¨æ—¶æ¨¡å‹çœ¼ç›è‡ªåŠ¨è·Ÿéšï¼Œå¯åœ¨è®¾ç½®ä¸­å¼€å…³
- è§¦ç¢°ååº”ï¼šç‚¹å‡»æ¨¡å‹çš„ hitArea è§¦å‘äº‹ä»¶ï¼Œç”±åç«¯ Agent å†³å®šååº”
- æ»šè½®ç¼©æ”¾ï¼šæ”¯æŒ 0.3x - 3.0x çš„ç¼©æ”¾èŒƒå›´

### æµå¼éŸ³é¢‘ç³»ç»Ÿ

**MSE æµå¼æ’­æ”¾**ï¼š
- ä½¿ç”¨ MediaSource Extensions
- è¾¹æ¥æ”¶è¾¹æ’­æ”¾ï¼Œå‡å°‘å»¶è¿Ÿ

**åˆ†ç‰‡ä¼ è¾“**ï¼š
- `audio_stream_start`ï¼šå¼€å§‹ä¼ è¾“
- å¤šä¸ª `audio_chunk`ï¼ˆBase64ï¼‰ï¼šéŸ³é¢‘æ•°æ®åˆ†ç‰‡
- `audio_stream_end`ï¼šç»“æŸä¼ è¾“

**å£å‹åŒæ­¥**ï¼š
- å®æ—¶åˆ†æéŸ³é¢‘é¢‘ç‡
- è‡ªåŠ¨æ›´æ–°æ¨¡å‹å˜´å·´å‚æ•°
- 30 FPS æ›´æ–°é¢‘ç‡

**æ—¶é—´è½´åŒæ­¥**ï¼š
- æ”¯æŒåœ¨éŸ³é¢‘æ’­æ”¾è¿‡ç¨‹ä¸­è§¦å‘åŠ¨ä½œ/è¡¨æƒ…/å‚æ•°å˜åŒ–
- è¯­ä¹‰æ ‡è®°ï¼š`start`ï¼ˆ0%ï¼‰ã€`early`ï¼ˆ15%ï¼‰ã€`middle`ï¼ˆ50%ï¼‰ã€`late`ï¼ˆ85%ï¼‰ã€`end`ï¼ˆ98%ï¼‰
- ç™¾åˆ†æ¯”ï¼š0-100 æ•°å­—ï¼Œç²¾ç¡®æ§åˆ¶è§¦å‘æ—¶æœº

### æœ¬åœ°è¯­éŸ³è¯†åˆ«

**å¼•æ“**ï¼šSherpa-ONNXï¼ˆçº¯æœ¬åœ°ï¼Œæ— éœ€è”ç½‘ï¼‰

**æµç¨‹**ï¼š
1. ç”¨æˆ·è¯­éŸ³è¾“å…¥
2. æœ¬åœ°è½¬æ–‡å­—
3. é€šè¿‡ WebSocket å‘é€ç»™åç«¯ Agent

**éšç§ä¿æŠ¤**ï¼š
- è¯­éŸ³æ•°æ®ä¸ä¸Šä¼ 
- å®Œå…¨æœ¬åœ°å¤„ç†

### æ’ä»¶ç³»ç»Ÿ

**æ¶æ„**ï¼š
- æ’ä»¶ä½œä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œ
- é€šè¿‡ WebSocket ä¸å‰ç«¯é€šä¿¡
- å…ƒä¿¡æ¯æ–‡ä»¶åŒ–ï¼ˆ`metadata.json`ï¼‰

**é…ç½®æ ¼å¼**ï¼š
```json
{
  "command": {
    "darwin": ["venv/bin/python3", "main.py"]
  },
  "workingDirectory": "plugins/terminal-plugin",
  "autoStart": false
}
```

**ç®¡ç†æ–¹å¼**ï¼š
- ç‹¬ç«‹çš„æ’ä»¶ç®¡ç†é¢æ¿ï¼ˆé¡¶æ  ğŸ§© æŒ‰é’®ï¼‰
- ç³»ç»Ÿæ‰˜ç›˜å¿«é€Ÿå…¥å£
- æ”¯æŒå¯åŠ¨/åœæ­¢/è¿æ¥/æ–­å¼€æ“ä½œ

**å†…ç½®æ’ä»¶**ï¼š
- ç»ˆç«¯æ§åˆ¶æ’ä»¶ï¼ˆ`terminal-plugin`ï¼‰
- UI è‡ªåŠ¨åŒ–æ’ä»¶ï¼ˆ`ui-automation-plugin`ï¼‰

## å¿«é€Ÿå¼€å§‹

```bash
npm install              # å®‰è£…ä¾èµ–
npm run compile          # ç¼–è¯‘ TypeScript
npm run dev:mac          # macOS å¼€å‘æ¨¡å¼
npm run dev:linux        # Linux å¼€å‘æ¨¡å¼
npm run dev:win          # Windows å¼€å‘æ¨¡å¼
```

## æ–‡ä»¶ç»“æ„

```
src/              - TypeScript æºç ï¼ˆä¸»è¿›ç¨‹ï¼‰
dist/             - ç¼–è¯‘è¾“å‡ºï¼ˆä¸»è¿›ç¨‹ï¼‰
renderer/
  â”œâ”€â”€ js/         - TypeScript æºç å’Œç¼–è¯‘è¾“å‡ºï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰
  â”‚   â”œâ”€â”€ settings-manager.ts/js    - è®¾ç½®ç®¡ç†å™¨
  â”‚   â”œâ”€â”€ live2d-manager.ts/js      - Live2D ç®¡ç†å™¨
  â”‚   â”œâ”€â”€ backend-client.ts/js      - åç«¯é€šä¿¡å®¢æˆ·ç«¯
  â”‚   â”œâ”€â”€ dialogue-manager.ts/js    - å¯¹è¯ç®¡ç†å™¨
  â”‚   â”œâ”€â”€ audio-player.ts/js        - æµå¼éŸ³é¢‘æ’­æ”¾å™¨
  â”‚   â”œâ”€â”€ plugin-connector.ts/js    - æ’ä»¶è¿æ¥å™¨
  â”‚   â”œâ”€â”€ plugin-ui.ts/js           - æ’ä»¶UIæ¸²æŸ“
  â”‚   â””â”€â”€ renderer.ts/js            - ä¸»åè°ƒè„šæœ¬
  â”œâ”€â”€ types/      - å…¨å±€ç±»å‹å®šä¹‰
  â”œâ”€â”€ index.html  - ä¸»é¡µé¢
  â””â”€â”€ styles.css  - æ ·å¼
docs/             - é¡¹ç›®æ–‡æ¡£
  â”œâ”€â”€ API.md      - WebSocket æ¶ˆæ¯åè®®è§„èŒƒ
  â”œâ”€â”€ USAGE.md    - ç”¨æˆ·ä½¿ç”¨è¯´æ˜
  â””â”€â”€ DEVELOPMENT.md - å¼€å‘è¯¦ç»†è¯´æ˜
models/           - Live2D æ¨¡å‹æ–‡ä»¶
plugins/          - æ’ä»¶ç›®å½•
  â”œâ”€â”€ terminal-plugin/      - ç»ˆç«¯æ§åˆ¶æ’ä»¶
  â””â”€â”€ ui-automation-plugin/ - UIè‡ªåŠ¨åŒ–æ’ä»¶
assets/           - èµ„æºæ–‡ä»¶
```

## æ¶ˆæ¯åè®®

### å‰ç«¯ â†’ åç«¯

- **user_input**ï¼šç”¨æˆ·æ–‡å­—/è¯­éŸ³è¾“å…¥
- **model_info**ï¼šæ¨¡å‹åŠ è½½åè‡ªåŠ¨å‘é€å¯ç”¨å‚æ•°ã€åŠ¨ä½œã€è¡¨æƒ…åˆ—è¡¨
- **tap_event**ï¼šæ¨¡å‹è§¦ç¢°äº‹ä»¶ï¼ˆhitArea + åæ ‡ï¼‰
- **character_info**ï¼šè§’è‰²äººè®¾ä¿¡æ¯ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰

### åç«¯ â†’ å‰ç«¯

- **dialogue**ï¼šæ–‡å­—å¯¹è¯
- **audio_stream_start/chunk/end**ï¼šæµå¼éŸ³é¢‘ä¼ è¾“
- **live2d**ï¼šåŠ¨ä½œ/è¡¨æƒ…/å‚æ•°æ§åˆ¶
- **sync_command**ï¼šç»„åˆæŒ‡ä»¤ï¼ˆåŒæ—¶æ‰§è¡Œå¤šä¸ªåŠ¨ä½œï¼‰

**è¯¦ç»†åè®®**ï¼šè§ `docs/API.md`

## å¼€å‘æ³¨æ„äº‹é¡¹

### ç±»å‹å®šä¹‰
- ç±»å‹å®šä¹‰ç»Ÿä¸€åœ¨ `renderer/types/global.d.ts` ä¸­ç»´æŠ¤
- æ–°å¢æ¥å£éœ€åŒæ­¥æ›´æ–°ç±»å‹å®šä¹‰

### ç¼–è¯‘
- æ‰€æœ‰ TypeScript æ–‡ä»¶éœ€ç¼–è¯‘åæ‰èƒ½è¿è¡Œ
- ä¿®æ”¹ä¸»è¿›ç¨‹ä»£ç ï¼ˆsrc/ï¼‰éœ€é‡å¯ Electron
- ä¿®æ”¹æ¸²æŸ“è¿›ç¨‹ä»£ç ï¼ˆrenderer/js/ï¼‰å¯çƒ­é‡è½½

### æ¶ˆæ¯å¤„ç†
- æ–°å¢æ¶ˆæ¯ç±»å‹éœ€åŒæ­¥æ›´æ–° `BackendMessage` ç±»å‹å®šä¹‰
- åœ¨ `backend-client.ts` çš„ `handleMessage` æ–¹æ³•ä¸­æ·»åŠ å¤„ç†é€»è¾‘

### è§†çº¿è·Ÿéšå®ç°
- ä½¿ç”¨ `pixi-live2d-display` åº“çš„ `focus()` æ–¹æ³•
- `focus(x, y)` æ¥å—ä¸–ç•Œç©ºé—´çš„åƒç´ åæ ‡
- é¼ æ ‡åæ ‡è®¡ç®—ï¼š`cursorPos - windowPos - rect.offset`
- å…³é—­è§†çº¿è·Ÿéšæ—¶ï¼Œé€šè¿‡ `focusController.focus(0, 0, true)` é‡ç½®

### è®¾å¤‡ç®¡ç†
- æ‘„åƒå¤´å’Œéº¦å…‹é£é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–
- é¿å…åº”ç”¨å¯åŠ¨æ—¶ç«‹å³è¯·æ±‚æƒé™
- åªåœ¨ç”¨æˆ·ä¸»åŠ¨ä½¿ç”¨æ—¶æ‰è¿æ¥è®¾å¤‡
